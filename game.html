<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FarmChain â€” Oyun</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body{margin:0;background:#0a0d18;color:#e9eef3;font-family:"Inter",system-ui}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.14)}
    .btn{padding:.45rem .7rem;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);color:#fff;cursor:pointer}
    .btn:hover{background:rgba(255,255,255,.12)}
    .pill{padding:.35rem .6rem;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06)}
  </style>
</head>
<body>
<header>
  <h2 style="margin:0">ðŸŒ± Ã‡iftliÄŸin</h2>
  <div style="display:flex;gap:8px;align-items:center">
    <span id="balance" class="pill">ðŸ’° 0 FC</span>
    <!-- âœ… GEÃ‡Ä°Åž BUTONU: BaÅŸta gizli -->
    <button id="btnToggleView" class="btn" style="display:none">â†” Admin / Oyun</button>
    <button id="btnLogout" class="btn">Ã‡Ä±kÄ±ÅŸ</button>
  </div>
</header>

<main style="padding:16px">
  <h3 id="farmTitle">HoÅŸgeldin!</h3>
  <p>BurasÄ± oyuncu ekranÄ± (demo).</p>
</main>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  // ðŸ‘‰ Supabase bilgilerinizi girin
  const supa = supabase.createClient("https://gukdmxepdgwrwniectnq.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd1a2RteGVwZGd3cnduaWVjdG5xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4NzgyODAsImV4cCI6MjA3MTQ1NDI4MH0.57j4LbCHdhoaYl05PBTRjNyQAV3SxvL07GUredTDWZU");

  let currentUser = null;

  document.addEventListener('DOMContentLoaded', init);

  async function init(){
    const { data:{ user } } = await supa.auth.getUser();
    if(!user){ location.href="index.html"; return; }
    currentUser = user;

    // Ã–rnek: baÅŸlÄ±ÄŸa Ã§iftlik adÄ±nÄ± getirebilirsiniz (varsa)
    try{
      const { data:f } = await supa.from('farms').select('farm_name').eq('user_id', user.id).maybeSingle();
      if(f?.farm_name) document.getElementById('farmTitle').textContent = `HoÅŸgeldin ${f.farm_name}!`;
    }catch(e){}

    await showAdminToggleIfAny();

    document.getElementById('btnLogout').onclick = logout;
  }

  // âœ… Admin ise butonu gÃ¶ster ve admin.html'e gÃ¶tÃ¼r
  async function showAdminToggleIfAny(){
    try{
      const { data, error } = await supa
        .from('user_roles')
        .select('role')
        .eq('user_id', currentUser.id)
        .eq('role','admin')
        .maybeSingle();

      const btn = document.getElementById('btnToggleView');
      if(!btn) return;

      if(!error && data){
        btn.style.display = 'inline-block';
        btn.onclick = () => location.href = 'admin.html';
      }else{
        btn.style.display = 'none';
      }
    }catch(e){
      console.warn(e);
    }
  }

  async function logout(){
    await supa.auth.signOut();
    location.href = "index.html";
  }
</script>
</body>
</html>